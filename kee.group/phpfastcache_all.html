<?php
// Include composer autoloader
require '/var/www/ee/scripts/phpfastcache/vendor/phpfastcache/phpfastcache/src/autoload.php';

use phpFastCache\CacheManager;

// Setup File Path on your config files
CacheManager::setup(array(
    "path" => "/var/www/ee/new_page_caching/", // or in windows "C:/tmp/"
));
// our unique method of caching, faster than traditional caching which shared everywhere on internet like 7-10 times
CacheManager::CachingMethod("phpfastcache");

// In your class, function, you can call the Cache
$InstanceCache = CacheManager::Files();


/**
 * Try to get $products from Caching First
 * product_page is "identity keyword";
 */
//$key = "Kee/phpfastcache_all";
$key = "phpfastcache_all";
$CachedString = $InstanceCache->get($key);

if (!is_null($CachedString)) 
{
	echo $CachedString;
	echo "<!-- End of Cached contents... -->";
}
else
{	
	ob_start();
?>
<!DOCTYPE html>
<html>
<head>
	<title>Northland Church</title>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<link href="//cloud.typography.com/6046374/767068/css/fonts.css" rel="stylesheet" type="text/css">
	<link rel="shorcut icon" href="/_img/favicon.png">
    <link rel="stylesheet" href="/_assets/css/css_prpl.css" type="text/css">
	<!-- Added to Augment PRPL's base CSS -->
	<link rel="stylesheet" href="/_assets/css/css_billy_added.css" type="text/css">
</head>
<body class="template-homepage">
	<header>
		<div class="nav-bar">
			<a id="mobile-menu-button" class="mobile-nav-close" href="#"><span class="icon-menu"></span></a>
			<a href="/" class="logo-text">
				Northland Church
				<span>A Church Distributed</span>
			</a>
		</div>

		<div class="nav-section">
			<a class="menu-button-back mobile-nav-close" href="#"><span class="icon-arrow-line"></span></a>

			<div class="nav-container">
				<div class="nav-level-overlay sub-nav-close">
					<div class="nav-image-container">
						<img src="/_img/img_prpl/icon-respond@2x.png" class="icon-image" width="35">
						<img src="/_img/img_prpl/icon-imago@2x.png" class="icon-image" width="35">
						<img src="/_img/img_prpl/icon-connect@2x.png" class="icon-image" width="35">
					</div>
				</div>
				<a href="/" class="logo-text">Northland Church <span>A Church Distributed</span></a>

				<nav class="nav-menu-section">
					<div class="search-bar">
						<form>
							<input type="text" placeholder="Search"><span class="icon-search"></span>
							<input type="submit" hidden="">
						</form>
					</div>
					<ul class="main-nav">
						<li>
							<a href="#sub-nav-1" class="sub-nav-expand nav-title">
								<img src="/_img/img_prpl/icon-respond@2x.png" class="icon-image">
								<h4>Respond to God</h4>
								<p>Daily Bible readings, prayer requests, and other tools to help you Respond to God</p>
							</a>
						</li>
						<li>
							<a href="#sub-nav-2" class="sub-nav-expand nav-title">
								<img src="/_img/img_prpl/icon-imago@2x.png" class="icon-image">
								<h4>Imago Dei</h4>
								<p>Teachings, music, articles, and podcasts to help you be formed in the image of God</p>
							</a>
						</li>
						<li>
							<a href="#sub-nav-3" class="sub-nav-expand nav-title">
								<img src="/_img/img_prpl/icon-connect@2x.png" class="icon-image">
								<h4>Connect @Northland</h4>
								<p>Ministries and events to help you connect, be equipped or serve and one of our locations</p>
							</a>
						</li>
					</ul>
					<ul class="secondary-nav">
						<li>
							<a href="#"><h5>Give</h5></a>
						</li>
						<li>
							<a href="#"><h5>Need Help</h5></a>
						</li>
						<li>
							<a href="/about"><h5>About</h5></a>
						</li>
					</ul>
					<a href="#" class="button button-main"><h6>New to Northland<span class="icon-arrow-filled"></span></h6></a>
					<a href="#" class="button button-main"><h6>New to God<span class="icon-arrow-filled"></span></h6></a>
				</nav>
				<nav class="sub-nav-container">
					<div id="sub-nav-1" class="sub-nav">
						<div class="sub-nav-container">
							<div class="nav-title">
								<img src="/_img/img_prpl/icon-respond@2x.png" class="icon-image">
								<h4>Respond to God</h4>
								<p>Daily Bible readings, prayer requests, and other tools to help you Respond to God</p>
							</div>
							<a href="#" class="button button-back sub-nav-close"><span class="icon-arrow-filled-left"></span>Back</a>
							<ul class="secondary-nav">
								<li>
									<a href="#"><h5>Read the Bible</h5></a>
								</li>
								<li>
									<a href="#"><h5>Pray</h5></a>
								</li>
								<li>
									<a href="#"><h5>Worship</h5></a>
								</li>
								<li>
									<a href="#"><h5>Be in Community</h5></a>
								</li>
								<li>
									<a href="#"><h5>Serve</h5></a>
								</li>
								<li>
									<a href="#"><h5>Give</h5></a>
								</li>
								<li>
									<a href="#"><h5>Go! (Missions)</h5></a>
								</li>
							</ul>
						</div>
					</div>
					<div id="sub-nav-2" class="sub-nav">
						<div class="sub-nav-container">
							<div class="nav-title">
								<img src="/_img/img_prpl/icon-imago@2x.png" class="icon-image">
								<h4>Imago Dei</h4>
								<p>Teachings, music, articles, and podcasts to help you be formed in the image of God</p>
							</div>
							<a href="#" class="button button-back sub-nav-close"><span class="icon-arrow-filled-left"></span>Back</a>
							<ul class="secondary-nav">
								<li>
									<a href="#"><h5>Blogs</h5></a>
								</li>
								<li>
									<a href="#"><h5>Worship Services</h5></a>
								</li>
								<li>
									<a href="#"><h5>Worship Highlights</h5></a>
								</li>
								<li>
									<a href="#"><h5>Ask a Pastor</h5></a>
								</li>
								<li>
									<a href="#"><h5>News &amp; Inspiration</h5></a>
								</li>
								<li>
									<a href="#"><h5>Spiritual Classics</h5></a>
								</li>
								<li>
									<a href="#"><h5>As Seen in Worship</h5></a>
								</li>
							</ul>
						</div>
					</div>
					<div id="sub-nav-3" class="sub-nav">
						<div class="sub-nav-container">
							<div class="nav-title">
								<img src="/_img/img_prpl/icon-connect@2x.png" class="icon-image">
								<h4>Connect @Northland</h4>
								<p>Ministries and events to help you connect, be equipped or serve and one of our locations</p>
							</div>
							<a href="#" class="button button-back sub-nav-close"><span class="icon-arrow-filled-left"></span>Back</a>
							<ul class="secondary-nav">
								<li>
									<a href="#"><h5>Random Bits of Wisdom</h5></a>
								</li>
								<li>
									<a href="#"><h5>Chasing Wisdom</h5></a>
								</li>
							</ul>
						</div>
					</div>
				</nav>
			</div>
			<div class="social-bar">
				<div class="container clearfix">
					<ul class="social-links">
						<li><a href="https://www.facebook.com/northlandchurch" class="icon-facebook"></a></li>
						<li><a href="https://twitter.com/northlandchurch" class="icon-twitter"></a></li>
						<li><a href="https://vimeo.com/northlandchurch" class="icon-soundcloud"></a></li>
						<li><a href="https://instagram.com/northlandchurch/" class="icon-instagram"></a></li>
						<li><a href="https://soundcloud.com/northlandchurch" class="icon-youtube"></a></li>
						<li><a href="https://www.youtube.com/user/NorthlandChurch" class="icon-vimeo"></a></li>
					</ul>
					<a class="contact-email" href="mailto:hello@northlandchurch.net"><span class="icon-email"></span>hello@northlandchurch.net</a>
				</div>
			</div>
		</div>

		<div class="body-overlay sub-nav-close"></div>
	</header>
	
	<div class="main-wrapper">
	
		<div class="container">	
			{!-- Hero Element --}
			{exp:channel:entries channel="controller" url_title="hero_controller"}
			{exp:playa:children offset="0" limit="1" disable="categories|member_data|pagination"}
				<section id="hero-section" style="background-image: url('{hero-element-image}');" {if hero-element-color-overlay == "Overlay"}class="color-overlay"{/if}>
					<div class="copy-container">
						<p class="date">{hero-element-start-date format="%F %j"}{if hero-element-end-date} - {hero-element-end-date format="%F %j, %Y"}{/if}</p>
						<h1>{hero-element-h1-title}</h1>
						<p class="body-copy">{hero-element-body-copy}</p>
						<a href="//{hero-element-link}" class="button button-main">Learn More</a>
					</div>
				</section>
			{/exp:playa:children}
			{/exp:channel:entries}
		</div>
	
		<section id="featured-section" class="card-section">
			<div class="container">
				<div class="card-row flex-tablet-min">
					{!-- Main Featured Blog Entry --}
					{exp:channel:entries channel="controller" url_title="featured_blogs_controller"}
					{exp:playa:children offset="0" limit="1" disable="categories|member_data|pagination"}
					{if channel=="Blogs"}
					<article class="card card-half">
						<div class="copy-container">
							 {!-- featured image --}
							<?php
							$img = "";
							ob_start();
							?>{blog-post}<?php
							$obcontents = ob_get_contents();
							ob_end_clean();
							$pattern = '/<img[^>]+src[\\s=\'"]+([^"\'>\\s]+)/is';
							if(preg_match($pattern,	$obcontents, $match)){
								$img = $match[1];
							}
							?>
							<div class="featured-image" style="background-image: url(<?php echo $img ?>);">
								<!-- this here image will be in the DOM, but hidden via CSS so that screen readers/page crawlers can still access it. The "src" attribute of this image should be dynamically inserted as the background image of its parent. -->
								<img src="<?php echo $img ?>" class="visually-hidden">
								<a href="/blogs/{url_title}"></a>
							</div>

							<h2>
								<a href="/blogs/{url_title}">{title}</a>
							</h2>

							{if blog-author}
							<p class="author">
								by <strong>{blog-author}</strong>
							</p>
							{/if}

							<p class="body-copy">
								{exp:trunchtml chars="150" inline="..."}{exp:strip_html}{blog-post}{/exp:strip_html}{/exp:trunchtml}
							</p>

							<a href="/blogs/{url_title}" class="main-link">Read More <span class="icon-arrow-filled"></span></a>
						</div><!-- /.copy-container -->
					</article>
					{/if}
					{/exp:playa:children}
					{/exp:channel:entries}

					
					{!--					--}
					{!-- Liturgy Reading 	--}
					{!--					--}
					<article class="card daily-liturgy" style="background-image: url('/_img/img_prpl/reading-bible-grayscale.jpg');">
					{!--
						This content is loaded via an ajax call (on document ready) to a separate EE template, '/_component/kee_liturgy'
						in order to avoid page caching
					--}
	
						{!-- Below is the placeholder --}
						<div class="copy-container" id="liturgy-placeholder" style="display:block">
						{exp:channel:entries channel="liturgy" orderby="date" sort="asc" show_future_entries="yes" 
									  start_on="2014-{current_time format='%m-%d'} 00:00" 
									  stop_before="2014-{current_time format='%m-%d'} 23:59" 
									  search:liturgy-sequence="=Morning"}	
							<div class="details">
								<div class="detail-left">
									<p class="card-title"><span class="icon-book-open"></span> Daily Liturgy</p>
								</div>
								<div class="detail-right">
									<p class="date">{entry_date format="%F %j"}</p>
								</div>
							</div>

							<h2>{title} {if liturgy-translation !="N/A"}{liturgy-translation}{/if}</h2>

							<p class="body-copy">
							{exp:trunchtml chars="300" inline="..."}{exp:strip_html}{liturgy-scripture}{/exp:strip_html}{/exp:trunchtml}
							</p>

							<!--	Link to morning liturgy at Liturgy page if it's long -->
							<a href="/resources/liturgy/#morning" class="button button-secondary">Read Now</a>	

							<!--	Implementation for Favorite function for reading -->
							{exp:favorites:saved entry_id="{entry_id}"}
								{if saved}
									<a class="button button-secondary favorite" href="/_component/favorite-add-loggedin/{entry_id}/" id="entry{entry_id}">Marked as read</a>					
								{/if}

								{if not_saved}
									<a class="button button-secondary favorite" href="/_component/favorite-add/{entry_id}/" id="entry{entry_id}">Mark as read</a>					
								{/if}
							{/exp:favorites:saved}
						{/exp:channel:entries}
						</div>
					
					</article>
				</div><!-- /.card-row -->
				<div class="card-row flex-tablet-min">
					{!-- Three More Featured Blog Entries --}
					{exp:channel:entries channel="controller" url_title="featured_blogs_controller"}
					{exp:playa:children offset="1" limit="3" disable="categories|member_data|pagination"}
					{if channel=="Blogs"}
						<article class="card card-third">
							<div class="copy-container">
								<p class="date">{entry_date format="%F %j, %Y"}</p>

								<h3><a href="/blogs/{url_title}">{title}</a></h3>

								{if blog-author}
								<p class="author">by <strong>{blog-author}</strong></p>
								{/if}		
							</div>
							<a href="/blogs/{url_title}" class="main-link">Read More <span class="icon-arrow-filled"></span></a>
						</article>
					{/if}
					{/exp:playa:children}
					{/exp:channel:entries}
				</div><!-- /.card-row -->
			</div><!-- /.container -->
		</section>
		
		<section id="past-news-section" class="card-section">

			<div class="section-tab color-green">
				<a href="/resources/videos/" class="tab-title">A Look to Last Week</a>
			</div>

			<div class="container">
				{embed="_component/new_past_news"}
			</div><!-- /.container -->
		</section>

		
		{!--					--}
		{!-- Prayer Section 	--}
		{!--					--}
		<section id="prayer-section">
			
			<div class="section-tab color-red">
				<a href="/resources/prayers" class="tab-title">Prayers</a>
			</div>
			
			<div class="container">
			{!--
				This content is loaded via an ajax call (on document ready) to a separate EE template, '/_component/new_prayers'
				in order to avoid page caching
			--}
			</div><!-- /.container -->
		</section>
		
		
		<section id="events-section">
			<div class="section-tab color-green">
				<a href="http://calendar.northlandchurch.net" class="tab-title">Featured Events</a>
			</div>
			<div class="container">
				{embed="_component/new_featuredevents"}
			</div><!-- /.container -->
		</section>
		
		
		<section id="serve-section">
			<div class="section-tab color-orange">
				<a href="/volunteer/" class="tab-title">Serve</a>
			</div>
			<div class="container">
				{embed="_component/new_serve"}
			</div><!-- /.container -->
		</section>
		
		
		<section id="social-section">
			<div class="section-tab color-blue">
				<a href="#" class="tab-title">Social</a>
			</div>

			<div class="container">
				<div class="card-row">
					<div id="social-feed-twitter" class="card card-social">
						{embed="_component/new_social_twitter"}
					</div><!-- /.card -->

					<div id="social-feed-instagram" class="card card-social">
						{embed="_component/new_social_instagram"}
					</div><!-- /.card -->

				</div>
			</div>
		</section>
		
		
		<footer>
			<div class="contact-information">
				<div class="container clearfix">
					<div class="form-section">
						<h3>Sign up for our Newsletter</h3>
						<h5>Find out about what's going on in the Northland community in our weekly email.</h5>

						<form>
							<input type="email" placeholder="Email Here" class="input-text">
							<input type="submit" value="submit" class="button-submit">
						</form>
					</div>

					<div class="location-section">

						<div class="clearfix">
							{!-- All Footer Locations, minus Longwood --}
							{exp:channel:entries category="532" channel="locations" entry_id="not 100"  orderby="title" sort="asc"}
							<div class="location">
								<div class="location-upper">
									{if location-url !=""}
									<a class="localist-page" href="{location-url}"></a>
									{/if}
									<h4><span class="icon-location-pin"></span>{title}</h4>
									<p>
									{location-address}
									</p>
								</div>
								<a href="tel:+1{location-phone}" class="contact-phone">{location-phone}</a>
							</div>
							{/exp:channel:entries}
						</div>
						<div class="clearfix">
							{!-- Place Longwood Location at the top --}
							{exp:channel:entries category="532" channel="locations" entry_id="100"}
							<div class="location">
								<div class="location-upper">
									{if location-url !=""}
									<a class="localist-page" href="{location-url}"></a>
									{/if}
									<h4><span class="icon-location-pin"></span>{title}</h4>
									<p>
									{location-address}
									</p>
								</div>
								<a href="tel:+1{location-phone}" class="contact-phone">{location-phone}</a>
							</div>
							{/exp:channel:entries}
						</div>
					</div>
				</div>
			</div>
			<div class="footer-bottom social-bar">
				<div class="container clearfix">
					<ul class="social-links">
						<li><a href="https://www.facebook.com/northlandchurch" class="icon-facebook"></a></li>
						<li><a href="https://twitter.com/northlandchurch" class="icon-twitter"></a></li>
						<li><a href="https://vimeo.com/northlandchurch" class="icon-vimeo"></a></li>
						<li><a href="https://instagram.com/northlandchurch/" class="icon-instagram"></a></li>
						<li><a href="https://soundcloud.com/northlandchurch" class="icon-soundcloud"></a></li>
						<li><a href="https://www.youtube.com/user/NorthlandChurch" class="icon-youtube"></a></li>
					</ul>
					<a class="contact-email" href="mailto:hello@northlandchurch.net"><span class="icon-email"></span>hello@northlandchurch.net</a>
				</div>
			</div>
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
			<script src="/_js/js_prpl/main.js"></script>
		</footer>
		
	</div><!-- /.main-wrapper -->

	<span class="result" style="display:none;"></span>

	<script type="text/javascript">
	$(document).ready(function(){
		// Load daily liturgy in order to avoid page caching
		$(".daily-liturgy").load("/_component/kee_liturgy", function() {
			console.log("kee_liturgy template loaded.");
			
			var now		= new Date();
			var nowHour	= now.getHours();
			
			// Dynamic Bible reading display according to local time
			if (nowHour >= 0 && nowHour < 12)
			{
				console.log("morning liturgy");
				$("#morning-liturgy").show();
			}
			else if (nowHour >= 12 && nowHour < 18)
			{
				console.log("midday liturgy");
				$("#midday-liturgy").show();
			}
			else
			{
				console.log("evening liturgy");
				$("#evening-liturgy").show();
			}
			
			// Handling favorite function for Bible reading
			$('.favorite').click(function() {		
				var whichID 	= $(this).attr('id');
				var count 		= $("span." + whichID).html();
				var link 		= $(this).attr('href');
				
				if ($(this).text() != "Marked as read")
				{
					// Call favorite link
					$('.result').load(link, function() {
					});
					$("span." + whichID).html(parseInt(count)+1);
					$(this).text("Marked as read");
				} else {
					console.log("Nothing happens");
				}

				return false;
			});
			
		});

		// Load prayers in order to avoid page caching
		$("#prayer-section > .container").load("/_component/new_prayers", function() {
			// Handling favorite function when clicked 'Pray Now' button
			$('.prayer-details-favorite').on("click", function() {
				var whichID 	= $(this).attr('id');
				var targetURL 	= $("#"+whichID+" .favorite-pray").attr('href');
				var count 		= $("#"+whichID+" .pray-count").html();
				var text 		= $("#"+whichID+" .favorite-pray").text();
				
				if (text != "You Prayed ")
				{
					// Call favorite link
					$.ajax({
						success: function(data){
							$("#"+whichID+" .pray-count").html(parseInt(count)+1);
							$("#"+whichID+" .favorite-pray").html("You Prayed <span class='icon-arrow-filled'></span>");
						},
						url: targetURL
					});		
				} else {
					console.log("Nothing happens");
				}

				return false;
			});	
		})
		
	});
	</script>

</body>
</html>
<?php
	$CachedString = ob_get_contents();
    // Write products to Cache in seconds with same keyword
	$InstanceCache->set($key, $CachedString, 120);
	
	ob_end_flush(); //flush output buffered
	echo "<!-- End of Real contents... -->";
}
?>